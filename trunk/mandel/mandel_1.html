<html>
<head>
    <title>Mandelbrot Set (black & white)</title>
    <script>
var N = 512;
var RANGE = [-2, 2];
var canvas = null;
var ctx = null;
    
var step = (function() {
    var changeInLastStep = true;
    
    var complexPlane = (function() {
        var ret = [];
        var dx, dy;
        dx = dy = (RANGE[1] - RANGE[0]) / N;
        var c = [RANGE[0], RANGE[0]];
        for (var j = 0; j < N; j++) {
            c[0] = RANGE[0];
            for (var i = 0; i < N; i++) {
                ret[i + j * N] = {'c': [c[0], c[1]], 'z': [0, 0]};
                c[0] += dx;
            }
            c[1] += dy;
        }
        return ret;
    })();

    function f(z, c) {
        return [z[0] * z[0] - z[1] * z[1] + c[0], 2 * z[0] * z[1] + c[1]];
    }
    
    function abs(z) {
        return Math.sqrt(z[0] * z[0] + z[1] * z[1]);
    }
    
    function walkCanvas() {
        if (!changeInLastStep) {
            return;
        }
    
        var imd = ctx.getImageData(0, 0, N, N);
        var cpa = imd.data;
        
        changeInLastStep = false;
        
        var idx1, idx2;
        idx1 = idx2 = 0;
        for (var i = 0; i < N * N; i++) {
            var cpe = complexPlane[idx2];
            var out = abs(cpe.z) > 2;
            if (!out) {
                complexPlane[idx2].z = f(cpe.z, cpe.c);
            }
            idx2++;
            if ((out && cpa[idx1] !== 255) || (!out && cpa[idx1] !== 0)) {
                changeInLastStep = true;
            }
            if (out) {
                cpa[idx1++] = 255;
                cpa[idx1++] = 255;
                cpa[idx1++] = 255;
            } else {
                cpa[idx1++] = 0;
                cpa[idx1++] = 0;
                cpa[idx1++] = 0;
            }
            cpa[idx1++] = 255;
        }
        
        ctx.putImageData(imd, 0, 0);
    }
    
    return walkCanvas;
})();

function start() {
    canvas = document.getElementById('main_canvas');
    ctx = canvas.getContext('2d');
    ctx.fillStyle = '#fff';
	ctx.fillRect(0, 0, N, N);
    
    setInterval(step, 100);
}
    </script>
</head>
<body onload="start()">
    <canvas id="main_canvas" width="512" height="512">
</body>
</html>